{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahang/OneDrive/Desktop/rst/app/page.tsx"],"sourcesContent":["\"use client\";\nimport socket from \"../lib/socket\";\nimport WaitingLobby from \"../components/WaitingLobby\";\nimport { userGamestore } from \"../store/userGamestore\";\nimport { useEffect, useState } from \"react\";\nimport GameRoom from \"../components/room/GameRoom\";\nimport type { GameState } from \"../types/game\";\nimport { useRouter } from \"next/navigation\";\nimport { getClientId } from \"../page\"; // Ensure this path is correct\n\nexport default function RoomPage() {\n  const router = useRouter();\n  const { gameState, setGameState } = userGamestore();\n  const [commentary, setCommentary] = useState<string | null>(null);\n\n  // 1. HANDLE GAME EVENTS & ERRORS\n  useEffect(() => {\n    const handleGameStateUpdate = (state: GameState) => {\n      console.log(\"Game state updated:\", state);\n      setGameState(state);\n      // Save valid room ID for valid reconnections later\n      localStorage.setItem(\"lastRoomId\", state.roomId);\n    };\n\n    const handleGameEnded = ({\n      gameState,\n      commentary,\n    }: {\n      gameState: GameState;\n      commentary: string;\n    }) => {\n      setGameState(gameState);\n      setCommentary(commentary);\n    };\n\n    const handleGameError = (err: string) => {\n      console.error(\"Game error received:\", err);\n\n      // CRITICAL FIX: If game is not found (stale ID), clear storage and go home\n      if (err === \"game not found\" || err.includes(\"not found\")) {\n        console.warn(\n          \"Invalid room detected. Clearing storage and redirecting.\"\n        );\n        localStorage.removeItem(\"lastRoomId\");\n        router.push(\"/\");\n      }\n    };\n\n    socket.on(\"gameStateUpdate\", handleGameStateUpdate);\n    socket.on(\"gameEnded\", handleGameEnded);\n    socket.on(\"gameError\", handleGameError);\n\n    return () => {\n      socket.off(\"gameStateUpdate\", handleGameStateUpdate);\n      socket.off(\"gameEnded\", handleGameEnded);\n      socket.off(\"gameError\", handleGameError);\n    };\n  }, [setGameState, router]);\n\n  // 2. HANDLE RECONNECTION (On Refresh Only)\n  useEffect(() => {\n    // Only try to reconnect if we have NO state but DO have a stored ID\n    const lastRoomId = localStorage.getItem(\"lastRoomId\");\n    if (!gameState && lastRoomId) {\n      console.log(\"Attempting to reconnect to:\", lastRoomId);\n      socket.emit(\"reconnectRoom\", {\n        roomId: lastRoomId,\n        clientId: getClientId(),\n      });\n    }\n  }, [gameState]); // Keep this dependency to check only when state is missing\n\n  // 3. HANDLE CLEANUP / LEAVE ROOM\n  useEffect(() => {\n    const lastRoomId = localStorage.getItem(\"lastRoomId\");\n\n    // If we have no state and no stored ID, we shouldn't be here -> Go Home\n    if (!gameState && !lastRoomId) {\n      router.push(\"/\");\n    }\n\n    // Cleanup function: ONLY runs when component unmounts (Refresh/Back Button)\n    return () => {\n      // We check if gameState exists roughly to see if we were in a game\n      // (Using the ref or just firing leaveRoom safely)\n      if (gameState?.roomId) {\n        console.log(\"Leaving room...\");\n        socket.emit(\"leaveRoom\", {\n          roomId: gameState.roomId,\n          clientId: getClientId(),\n        });\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []); // <--- CRITICAL FIX: Empty dependency array prevents kicking player on every render\n\n  // 4. RENDER LOADING STATE\n  if (!gameState)\n    return (\n      <div className=\"text-center p-10 text-fg\">\n        <p>Loading room...</p>\n        <button\n          onClick={() => {\n            localStorage.removeItem(\"lastRoomId\");\n            router.push(\"/\");\n          }}\n          className=\"mt-4 text-sm text-purple underline cursor-pointer\"\n        >\n          Stuck? Click here to go Home\n        </button>\n      </div>\n    );\n\n  const currentPlayer = gameState.players.find(\n    (p) => p.clientId === getClientId()\n  );\n  const isEliminated = currentPlayer?.isEliminated;\n\n  switch (gameState.status) {\n    case \"LOBBY\":\n      return (\n        <WaitingLobby\n          players={gameState.players}\n          roomId={gameState.roomId}\n          maxPlayers={gameState.maxPlayers}\n        />\n      );\n    case \"INGAME\":\n      return (\n        <div className=\"relative w-full h-full\">\n          {isEliminated && (\n            <div className=\"fixed top-0 left-0 w-full h-16 bg-red-600/90 text-white z-50 flex items-center justify-center font-bold text-xl animate-pulse\">\n              YOU HAVE BEEN DISQUALIFIED!\n            </div>\n          )}\n          <div\n            className={\n              isEliminated ? \"opacity-75 pointer-events-none grayscale\" : \"\"\n            }\n          >\n            <GameRoom />\n          </div>\n        </div>\n      );\n    case \"FINISHED\":\n      return (\n        <div className=\"flex flex-col items-center justify-center min-h-screen p-10 text-center space-y-6\">\n          <h1 className=\"text-6xl font-black text-(--color-pink)\">GAME OVER</h1>\n          <div className=\"text-2xl\">\n            Winner:{\" \"}\n            <span className=\"font-bold text-green-400\">{gameState.winner}</span>\n          </div>\n          {commentary && (\n            <div className=\"bg-(--color-line) p-6 rounded-xl border border-(--color-purple) max-w-2xl mt-8\">\n              <h3 className=\"text-sm uppercase tracking-widest text-(--color-comment) mb-2\">\n                AI Commentator\n              </h3>\n              <p className=\"text-xl italic font-serif leading-relaxed\">\n                \"{commentary}\"\n              </p>\n            </div>\n          )}\n\n          <button\n            onClick={() => {\n              localStorage.removeItem(\"lastRoomId\"); // Clean up so we don't reconnect to finished game\n              router.push(\"/\");\n            }}\n            className=\"px-6 py-3 bg-(--color-purple) rounded-lg font-bold hover:scale-105 transition\"\n          >\n            Back to Home\n          </button>\n        </div>\n      );\n    default:\n      return <div>Unknown game status!</div>;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 309, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahang/OneDrive/Desktop/rst/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0]}}]
}